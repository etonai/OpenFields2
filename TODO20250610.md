# OpenFields2 Development TODO

## Section 1: Debug Messages
**Goal**: Make debug output conditional on existing in-game debug mode toggle

### Tasks:
- [ ] Locate existing debug mode toggle system
- [ ] Wrap existing debug messages in debug mode checks:
  - Sound loading messages ("*** Attempting to play sound", "*** Sound loaded successfully")
  - Combat action messages (">>> Removed all scheduled actions", "--- Ranged attack impact scheduled")
  - Attack continuation messages ("continues attacking (persistent mode)")
  - Ammunition status messages ("is out of ammunition, starting automatic reload")

## Section 2: Civil War Theme
**Goal**: Create Civil War era theme while maintaining test_theme for development

### Tasks:
- [ ] Create new theme directory structure: `src/main/resources/data/themes/civil_war/`
- [ ] Define Civil War theme.json with currentDate: April 16, 1861
- [ ] Create Civil War specific weapons.json (Union equipment focus)
- [ ] Create Civil War specific weapon-types.json  
- [ ] Create Civil War specific skills.json
- [ ] Ensure test_theme remains default for development

## Section 3: Character Name Generation
**Goal**: Implement nickname-based name generation with historical accuracy

### Tasks:
- [ ] Research and compile 1880s name frequency data for males from https://www.ssa.gov/oact/babynames/decades/names1880s.html
- [ ] Create name data files for themes:
  - [ ] `test_theme/names.json` with male name frequencies (hardcoded for now)
  - [ ] `civil_war/names.json` with period-appropriate male names
- [ ] Modify CharacterFactory.generateName() to:
  - [ ] Use existing nickname field for generated names
  - [ ] Generate appropriate nicknames (first names + alternatives)
  - [ ] Use frequency-weighted random selection
  - [ ] Calculate birthdates for ages 18-45 based on theme.currentDate
- [ ] Update Character creation to use new name system

## Section 4: New Character Placement
**Goal**: Handle character placement collisions

### Tasks:
- [ ] Implement collision detection for character placement
- [ ] Add logic to offset new character by 4 feet (28 pixels) when collision detected
- [ ] Implement sequential X+4 feet checking for multiple collisions
- [ ] Set maximum of 10 placement attempts before failing
- [ ] Test placement system with multiple characters

## Section 5: Repeated Firing
**Goal**: Add realistic firing delays for multi-shot weapons

### Tasks:
- [ ] Add firing delay property to weapon data
- [ ] Implement firing delay timing in weapon state system
- [ ] Define specific firing delays by weapon action type:
  - [ ] Semi-automatic weapons: 10 tick recovery delay between shots
  - [ ] Bolt-action rifles: 180 tick (3 second) delay before aiming again
  - [ ] Semi-automatic pistols: 10 tick recovery delay
  - [ ] Single action revolvers: 30 tick recovery delay
  - [ ] Double action revolvers: 20 tick recovery delay (66% of single action)
  - [ ] Brown Bess musket: 60 tick (1 second) recovery delay
- [ ] Update weapon definitions with firing delays
- [ ] Test with multi-shot weapons
- [ ] Ensure aiming is the primary delay for successive shots on semi-automatic weapons

## Section 6: New Weapons
**Goal**: Add new weapons and explore combat system extensions

### Tasks:
- [ ] Add Lee Enfield Rifle:
  - [ ] Bolt action mechanism
  - [ ] 10 round magazine
  - [ ] 2314 fps velocity
  - [ ] 180 tick (3 second) firing delay
  - [ ] 2 foot weapon length (for bayonet attachment)
- [ ] Add M1 Garand:
  - [ ] Semi-automatic mechanism
  - [ ] 8-round en bloc clip system
  - [ ] ~2800 fps velocity
  - [ ] 10 tick firing delay
  - [ ] 2 foot weapon length (for bayonet attachment)
- [ ] Design bow implementation:
  - [ ] Damage: 6
  - [ ] Velocity: 200 fps
  - [ ] Reload timing: 180 ticks (3 seconds)
  - [ ] Ammunition capacity: 1 (always reloading after each shot)
  - [ ] Unlimited arrows for characters
  - [ ] Create new BOW weapon type category
  - [ ] Use existing hit roll difficulty for physics simulation
  - [ ] Use same body part hit distribution as firearms
- [ ] Design and implement melee combat system:
  - [ ] Define small/medium/large weapon categories based on existing weapons
  - [ ] Implement melee range system (4 feet + weapon length)
  - [ ] Add auto-movement when target is out of melee range
  - [ ] Implement persistent pursuit if defender moves during approach
  - [ ] Execute melee attack once attacker reaches range
  - [ ] Use same damage values as ranged weapon system
  - [ ] Add unarmed combat type with base damage 4 and 4 feet range
  - [ ] Create special unarmed damage tables:
    - [ ] No critical wounds for arm/leg/chest hits
    - [ ] Reduce critical wound chance by 50% for abdomen/head hits
    - [ ] Redistribute reduced critical chances equally to light/serious wounds
  - [ ] Copy ranged weapon body part hit distribution code
  - [ ] Apply 10% of strength stat modifier to melee damage (use existing statToModifier function)
  - [ ] Use existing ranged attack animation system
  - [ ] Create specific melee weapons with damage values, lengths, and attack timing:
    - [ ] Knife: damage 6, length 1 foot, small weapon, 30 tick (0.5 second) attack
    - [ ] Bayonet: damage 8, length 2 feet, medium weapon, 45 tick (0.75 second) attack
    - [ ] Tomahawk: damage 10, length 1.5 feet, medium weapon, 45 tick (0.75 second) attack
    - [ ] Sword: damage 12, length 3 feet, large weapon, 60 tick (1 second) attack
  - [ ] Add melee/ranged mode toggle key for bayonet-equipped rifles
  - [ ] Implement melee auto-movement without pathfinding or collision handling

## Section 7: Headshots
**Goal**: Implement targeted headshot system

### Tasks:
- [ ] Add body part targeting options (head vs center mass)
- [ ] Implement headshot probability similar to extraordinary chest shot mechanics
- [ ] Implement miss distribution (head misses can hit chest/other parts)
- [ ] Add UI for selecting target area (H key toggle when character selected)
- [ ] Display targeting mode in character stats (? key)
- [ ] Handle headshot damage similar to chest shot system (no special multipliers)
- [ ] Apply consistent difficulty across all weapon types and ranges

## Section 8: Stray Shots
**Goal**: Implement stray shot mechanics for all weapons

### Tasks:
- [ ] Define miss scatter patterns with danger radius = 5% of range to target (min 5 feet, max 15 feet)
- [ ] Implement nearby unit detection for stray shots (excluding original shooter)
- [ ] Add 5% probability system for hitting randomly selected secondary targets
- [ ] Apply stray shot mechanics to all weapons (not just muskets)
- [ ] Add stray shot combat messages indicating shooter and intended target
- [ ] Test with Brown Bess and other inaccurate weapons
- [ ] Balance realism vs gameplay impact

## Section 9: Automatic Weapons
**Goal**: Design system for rapid-fire weapons

### Tasks:
- [ ] Research automatic weapon mechanics (cyclic rate, burst vs full auto)
- [ ] Design ammunition consumption system (track individual rounds)
- [ ] Implement firing modes: single shot, 3-round burst, and full-auto
- [ ] Add fire mode selection key (F key) for selected characters (requires weapon support)
- [ ] Issue warning when F key pressed on weapons without multiple fire modes
- [ ] Display current fire mode in character stats (? key)
- [ ] Implement sustained fire mechanics: aim once, fire automatically until ammo/toggle
- [ ] Add recoil penalty (-20) for 2nd and successive shots in automatic fire (stacks with same-target bonuses)
- [ ] Implement automatic reload cycle when ammunition exhausted
- [ ] Add weapon heating/jamming mechanics (optional)
- [ ] Create example automatic weapon: Uzi submachine gun
  - [ ] 10 rounds per second cyclic rate (6 ticks between shots)
  - [ ] Support single shot, 3-round burst, and full-auto modes
  - [ ] Single shot mode: fires one round per trigger activation (aim → shoot → 6 tick delay → aim again)
  - [ ] 3-round burst fires exactly 3 rounds per trigger activation and stops
  - [ ] 32-round magazine capacity
  - [ ] Note: Uzi is currently the only weapon with single/burst/full-auto capabilities

## Section 10: Hesitations
**Goal**: Simulate momentary hesitation when characters take wounds

### Tasks:
- [ ] Implement hesitation timing system:
  - [ ] Light wounds: 1/4 second (15 ticks) hesitation
  - [ ] Serious wounds: 1 second (60 ticks) hesitation
  - [ ] Critical wounds: 1 second (60 ticks) hesitation (same as serious)
- [ ] Add hesitation events to event queue system
- [ ] Implement event priority system:
  - [ ] Hesitation events must complete before any other character actions
  - [ ] Pause ongoing actions during hesitation, resume where left off
  - [ ] Block new events for wounded character during hesitation
  - [ ] Stack multiple hesitations (do not reset)
  - [ ] Stop automatic fire on serious+ wounds, resume after hesitation
  - [ ] Pause melee movement during hesitation, resume after
  - [ ] For aiming actions: pause aiming only, preserve aiming progress
- [ ] Integrate hesitation with wound application system
- [ ] Exclude incapacitated characters from hesitation system
- [ ] Test hesitation timing with different wound types
- [ ] Consider visual feedback for hesitating characters (optional)

### Technical Implementation Notes:
- Add hesitation duration to wound severity system
- Create hesitation ScheduledEvent type
- Modify event queue to prioritize/block events by character
- Integrate wound → hesitation event creation

---

## Summary of Remaining Questions

No remaining questions - all sections have complete implementation guidance.
