# Burst Firing Fix - DevCycle 2025_0020
*Created: 2025-06-24 | Status: Planning*

## Overview
This development cycle focuses specifically on fixing burst firing functionality in the OpenFields2 tactical combat game. Based on the comprehensive burst mode analysis from DevCycle 19, this cycle will identify and resolve any issues preventing burst firing from working correctly.

**Development Cycle Goals:**
- Diagnose current burst firing issues
- Fix broken burst firing mechanics
- Validate burst firing works correctly across all scenarios
- Ensure proper integration with existing combat systems

**Prerequisites:** 
- DevCycle 19 completed (Platform Integration and Combat Enhancement)
- Burst mode analysis documentation available
- Combat system stabilized with first attack penalty system

**Estimated Complexity:** Medium - Focused debugging and fixing of existing system

## System Analysis

### 1. Burst Firing Issue Investigation ‚è≥ **IN PROGRESS**
- [ ] **Current State Assessment**
  - [ ] Test burst firing with different weapon types (UZI, other SMGs)
  - [ ] Verify firing mode cycling works correctly
  - [ ] Check burst shot scheduling and timing
  - [ ] Validate ammunition consumption during bursts
  - [ ] Test burst interruption scenarios

- [ ] **Issue Identification**
  - [ ] Document specific broken behaviors
  - [ ] Identify root causes of burst firing failures
  - [ ] Determine if issues are in scheduling, state management, or execution
  - [ ] Check integration with first attack penalty system (DevCycle 19)

**Analysis Framework:**
- **Systematic Testing**: Test each component of burst firing individually
- **Event Tracing**: Monitor ScheduledEvent queue during burst sequences
- **State Debugging**: Track isAutomaticFiring and burstShotsFired variables
- **Integration Validation**: Ensure compatibility with recent combat system changes

### 2. Core Burst Mechanics Fix üîß **PENDING**
- [ ] **State Management Repairs**
  - [ ] Fix isAutomaticFiring state transitions
  - [ ] Correct burstShotsFired counting logic
  - [ ] Validate savedAimingSpeed preservation and restoration
  - [ ] Ensure proper burst termination conditions

- [ ] **Event Scheduling Corrections**
  - [ ] Fix burst shot scheduling in event queue
  - [ ] Correct timing calculations for cyclic rate
  - [ ] Validate event execution order and dependencies
  - [ ] Ensure proper cleanup of failed/interrupted bursts

- [ ] **Ammunition and Target Validation**
  - [ ] Fix ammunition checking during burst sequences
  - [ ] Correct target validation for follow-up shots
  - [ ] Implement proper burst interruption handling
  - [ ] Validate incapacitation checks during bursts

## Technical Implementation Plan

### Primary Fix Areas

**1. Character Burst State Management**
- File: `src/main/java/combat/Character.java`
- Focus: Lines around 1118-1162 (burst scheduling code)
- Key Variables: `isAutomaticFiring`, `burstShotsFired`, `savedAimingSpeed`

**2. Firing Mode Integration**
- File: `src/main/java/combat/RangedWeapon.java`
- Focus: Firing mode cycling and burst configuration
- Key Methods: `cycleFiringMode()`, burst size validation

**3. Event Scheduling System**
- File: `src/main/java/game/ScheduledEvent.java` integration
- Focus: Proper burst shot event creation and execution
- Key Areas: Event timing, cleanup, and interruption handling

### Potential Issue Categories

**A. State Management Issues**
- Burst state not properly initialized or reset
- Incorrect shot counting during burst sequences
- Aiming speed not properly saved/restored

**B. Event Scheduling Problems**
- Burst shots not being scheduled correctly
- Timing calculations incorrect for cyclic rate
- Events being cancelled or interrupted improperly

**C. Integration Conflicts**
- First attack penalty system interfering with burst mechanics
- Target tracking logic conflicting with burst sequences
- Combat resolver not handling burst shots correctly

## Testing Strategy

### 1. Unit Testing Approach
- [ ] **Individual Component Tests**
  - Test burst state transitions in isolation
  - Validate event scheduling mathematics
  - Check ammunition consumption calculations
  - Verify aiming speed transitions

### 2. Integration Testing
- [ ] **End-to-End Burst Scenarios**
  - Single target burst firing
  - Multi-target scenarios with bursts
  - Burst interruption by target loss
  - Burst interruption by ammunition depletion
  - Burst firing with different aiming speeds

### 3. Combat System Integration
- [ ] **Compatibility Validation**
  - Burst firing with first attack penalty system
  - Burst firing with very careful aiming
  - Burst firing in different movement states
  - Burst firing with wound modifiers active

## Success Criteria

### Functional Requirements
- [ ] Burst firing mode activates correctly when selected
- [ ] Exactly 3 shots fired for standard burst weapons (UZI)
- [ ] Proper timing between burst shots (6 ticks for UZI)
- [ ] First shot uses character's aiming speed, subsequent shots use Quick
- [ ] Ammunition properly consumed (3 rounds per burst)
- [ ] Burst state properly reset after completion

### Quality Requirements
- [ ] No burst firing crashes or exceptions
- [ ] Proper console logging for burst sequences
- [ ] Clean event queue management (no orphaned events)
- [ ] Consistent behavior across all burst-capable weapons

### Integration Requirements
- [ ] Compatible with first attack penalty system
- [ ] Works with all aiming speeds including very careful
- [ ] Functions correctly with movement penalties
- [ ] Integrates properly with wound system and hesitation

## Implementation Timeline

### Phase 1: Diagnosis (Estimated: 2-4 hours)
1. **Test Current Burst Firing**: Comprehensive testing of existing functionality
2. **Issue Documentation**: Record all observed problems and failure modes
3. **Root Cause Analysis**: Identify primary causes of burst firing failures

### Phase 2: Core Fixes (Estimated: 3-6 hours)
1. **State Management Repair**: Fix burst state variables and transitions
2. **Event Scheduling Correction**: Repair burst shot scheduling logic
3. **Integration Debugging**: Resolve conflicts with recent combat system changes

### Phase 3: Validation (Estimated: 1-2 hours)
1. **Comprehensive Testing**: Test all burst firing scenarios
2. **Integration Validation**: Ensure compatibility with all combat systems
3. **Documentation Update**: Update burst mode analysis with fixes

## Risk Assessment

### Technical Risks
- **Complex State Dependencies**: Medium - Burst firing involves multiple interacting systems
- **Event Timing Precision**: Medium - Precise timing required for realistic burst sequences
- **Integration Complexity**: Low - Recent combat changes may have affected burst mechanics

### Schedule Risks
- **Issue Complexity**: Medium - Unknown depth of current problems
- **Testing Time**: Low - Well-defined test scenarios available

## Quality Assurance

### Code Quality Standards
- [ ] All burst-related code follows project conventions
- [ ] Proper error handling for burst interruption scenarios
- [ ] Clean separation between burst logic and other combat systems
- [ ] Comprehensive logging for debugging burst sequences

### Testing Requirements
- [ ] Manual testing of all burst scenarios
- [ ] Automated testing where applicable
- [ ] Performance validation (no significant overhead)
- [ ] Memory leak detection for event cleanup

---

## Development Workflow

### Commit Message Format
- **Format**: `DC-20: [Burst fix description]`
- **Examples**: 
  - `DC-20: Fix burst shot event scheduling`
  - `DC-20: Repair burst state management in Character.java`
  - `DC-20: Correct ammunition consumption during bursts`

### Testing Commands
```bash
mvn compile                              # Verify compilation
mvn test                                # Run existing tests  
mvn javafx:run                          # Test burst firing in game
```

### Debugging Approach
```bash
# Enable debug mode to trace burst firing
# Use Ctrl+D in game for detailed combat logging
# Monitor console output during burst sequences
# Check event queue state during burst firing
```

---

*This development cycle uses a focused debugging approach to identify and fix specific burst firing issues. The goal is to restore full burst firing functionality with minimal changes to the broader combat system.*