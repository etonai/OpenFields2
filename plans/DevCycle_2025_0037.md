# Iterative Development Cycle - DevCycle 2025_0037
*Created: 2025-07-02 at 2:59 PM PDT | Last Design Update: 2025-07-02 at 2:59 PM PDT | Last Implementation Update: [Date] at [Time] | Implementation Status: Ready for System 1 Planning*

## Overview
This is an iterative development cycle focused on implementing multiple varied tasks to improve system stability, fix critical bugs, and enhance game mechanics. The cycle will address several independent issues and improvements identified through testing and analysis.

**IMPORTANT ITERATIVE CYCLE PRINCIPLES:**
- **One System at a Time**: Focus completely on implementing one system before considering the next
- **No Future Planning**: Do NOT plan future systems while working on the current system
- **No Premature Implementation**: Do NOT implement systems before they are fully planned
- **Sequential Implementation**: Complete each system fully (including testing) before moving to the next
- **Flexible Scope**: Systems 2+ are defined only after System 1 is complete
- **Empty Placeholders**: Future system sections must contain no hints about what those systems should cover
- **⚠️ CYCLE NEVER COMPLETE UNTIL CLOSED**: Even when all planned systems are finished, the cycle remains open for additional systems until explicitly ordered to close

**Development Cycle Goals:**
- Update CLAUDE.md with comprehensive development cycle tracking and plan document location information
- Implement additional system improvements and bug fixes as needed
- Enhance test coverage and validation for affected components
- Address any additional issues discovered during iterative development

**Prerequisites:** 
- DevCycle 36 successfully completed and merged
- All existing tests passing
- Clean working directory

**Estimated Complexity:** Low - Documentation update with file analysis and structured information organization

## System Implementations

### 1. CLAUDE.md Development Cycle Tracking Enhancement ✅ **COMPLETE**
*Update CLAUDE.md to include comprehensive development cycle tracking and documentation location information.*

- [x] **Development Cycle Status Tracking**
  - [x] Add section documenting last completed cycle (DevCycle 36)
  - [x] Add section for current active cycle tracking
  - [x] Include cycle completion dates and status indicators
  - [x] Document cycle numbering system and naming conventions

- [x] **Plan Document Location Registry**
  - [x] Document current/active plan document locations in `plans/` directory
  - [x] Document completed plan document locations in `plans/completed/` directory 
  - [x] Document plan template locations in `plans/` directory
  - [x] Include template naming conventions and usage guidelines

- [x] **Workflow Process Enhancement**
  - [x] Update DevCycle_workflow_plan.md to include CLAUDE.md update steps in cycle closure
  - [x] Add plan document archiving steps to workflow for moving documents to completed directory
  - [x] Define system completion procedures within cycles (documentation updates and commits)
  - [x] Integrate CLAUDE.md maintenance into standard workflow processes
  - [x] Add user authorization requirements for development cycle closure procedures

**Design Specifications:**
- **Last Completed Cycle Tracking**: CLAUDE.md must indicate DevCycle 36 as the most recently completed cycle with completion date
- **Current Cycle Awareness**: CLAUDE.md must indicate DevCycle 37 as the currently active cycle
- **Document Location Mapping**: Complete directory structure documentation for all plan-related files
- **Template Documentation**: Clear guidance on available templates and their purposes
- **Maintenance Guidelines**: Instructions for keeping cycle tracking information current
- **Workflow Integration**: DevCycle_workflow_plan.md must include CLAUDE.md updates in cycle closure procedures
- **Document Archiving Process**: Clear steps for moving plan documents to completed directory during cycle closure
- **System Completion Protocol**: Standardized steps for marking systems complete within cycles (documentation updates and commits)
- **User Authorization Security**: Cycle closure procedures must require user identity verification and explicit authorization

**Technical Implementation Notes:**
- **Key Files to Modify**: 
  - `/mnt/c/dev/TTCombat/OF2Prototype01/CLAUDE.md` - Add cycle tracking and document location sections
  - `/mnt/c/dev/TTCombat/OF2Prototype01/plans/DevCycle_workflow_plan.md` - Add workflow enhancements for cycle closure and system completion
- **New Sections to Add**: 
  - "Development Cycle Tracking" section in CLAUDE.md
  - "Planning Document Structure" section in CLAUDE.md
  - "Document Location Reference" subsection in CLAUDE.md
  - "CLAUDE.md Update Steps" in cycle closure workflow
  - "Plan Document Archiving" procedures in workflow
  - "System Completion Protocol" steps in workflow
  - "User Authorization for Cycle Closure" security procedures in workflow
- **Information Sources**: Analyze `plans/` directory structure and `plans/completed/` directory contents
- **Backwards Compatibility**: Maintain all existing content while adding new tracking and workflow sections

### 2. Target Switch Delay After Incapacitation ⭕ **PLANNED**
*Implement a reflexes-modified delay when characters switch targets after incapacitating an opponent in auto-targeting mode.*

- [ ] **Target Incapacitation Detection**
  - [ ] Identify when a character's current target becomes incapacitated (health <= 0)
  - [ ] Detect when auto-targeting system needs to switch to next target after incapacitation
  - [ ] Distinguish between incapacitation-triggered switching vs. other target changes (range, obstruction, zones)
  - [ ] Integration with existing CombatCoordinator target management
  - [ ] Implement "first incapacitation only" logic to prevent delay stacking from burst fire

- [ ] **Reflexes-Modified Delay Implementation**
  - [ ] Implement base 15-tick delay for target switching after incapacitation only
  - [ ] Apply reflexes stat modifier using existing formula: `15 × (1.0 - (reflexesModifier * 0.015))`
  - [ ] Use GameConstants.statToModifier() for reflexes modifier calculation (consistent with weapon readying)
  - [ ] Create ScheduledEvent for delay timing integration
  - [ ] Implement delay state tracking in AutoTargetingSystem (isWaitingForTargetSwitch flag)

- [ ] **Delay State Management and Cancellation**
  - [ ] Implement manual target assignment cancellation (player control overrides delay)
  - [ ] Implement movement order cancellation (movement cancels auto-targeting delay)
  - [ ] Ensure damage taken does NOT cancel delay (maintains realism)
  - [ ] Ensure new closer enemies do NOT interrupt delay (prevents complex priority recalculation)
  - [ ] Verify delay remains separate from weapon states (can overlap with aiming/reloading)

**Design Specifications:**
- **Base Delay Duration**: 15 ticks (0.25 seconds at 60 ticks/second) when switching targets after incapacitation
- **Reflexes Integration**: Use existing reflexes stat modifier system (identical to weapon readying speed calculation)
- **Delay Formula**: `targetSwitchDelay = 15 × (1.0 - (reflexesModifier * 0.015))` where higher reflexes = shorter delay
- **Scope Limitation**: Only applies to auto-targeting when current target becomes incapacitated (NOT for range/obstruction/zone changes)
- **State Management**: Manual actions and movement orders cancel delay; damage and new closer enemies do NOT cancel delay
- **Combat Integration**: Delays are separate from weapon states and can overlap with aiming/reloading/recovering
- **Multiple Incapacitation**: Only the first incapacitation triggers delay; subsequent incapacitations during delay period are ignored
- **Skill Integration**: Uses only reflexes modifiers (NOT Quickdraw skill)
- **Weapon Universality**: Same base 15-tick delay for all weapon types (mental processing, not weapon-specific)
- **Target Selection**: Uses existing zone priority system with fresh target evaluation when delay completes
- **No Additional Feedback**: No visual/audio cues for initial implementation - delay timing is the feedback
- **Combat Realism**: Simulates cognitive processing time needed to recognize "target down, need new target"
- **User Experience**: Prevents unrealistic instant target switching while maintaining responsive player control override

**Technical Implementation Notes:**
- **Key Files to Modify**: 
  - `combat/AutoTargetingSystem.java` - Add incapacitation-specific delay logic and state management
  - `utils/GameConstants.java` - Access existing statToModifier() function for reflexes calculation
  - `game/ScheduledEvent.java` - Use for delay timing (no modifications needed)
- **New Components Required**:
  - **Incapacitation-Specific Detection**: Monitor ONLY target incapacitation (health <= 0), not other target changes
  - **Target Switch Delay State**: Track delay active status, prevent multiple delays from burst fire
  - **Reflexes-Based Timing**: Calculate delay using existing formula pattern from weapon readying system
  - **Cancellation Logic**: Handle manual target assignment and movement order cancellation
- **Integration Points**: 
  - GameConstants.statToModifier() for consistent reflexes calculation
  - Existing AutoTargetingSystem.updateAutomaticTargeting() method
  - Current zone priority target selection system
  - ScheduledEvent system for delay timing
  - Character reflexes stat access
- **Implementation Approach**: Full reflexes-modified system (not simple fixed delay)
- **Backwards Compatibility**: No impact on manual target switching, non-auto-targeting combat, or other automatic target changes

## System Interaction Specifications
**Cross-system integration requirements and conflict resolution:**

*Note: This section will be updated as each system is completed and interactions are discovered.*

- **System 1 + Existing Systems**: CLAUDE.md documentation update has no direct system integration dependencies
- **System 2 + Auto-Targeting System**: Target switch delay integrates with existing auto-targeting without disrupting manual targeting
- **System 2 + Reflexes Stat System**: Reuses existing reflexes modifier calculation from weapon readying speed system
- **Event Queue Management**: System 2 uses ScheduledEvent system for target switch delay timing

**System Integration Priorities:**
1. **System 1**: Documentation enhancement with no code integration required ✅ **COMPLETE**
2. **System 2**: Combat behavior enhancement requiring auto-targeting and reflexes system integration (current priority)
3. **Future Systems**: Priority determined after System 2 completion

## Technical Architecture

### Code Organization
**Files requiring modification:**
- **`/mnt/c/dev/TTCombat/OF2Prototype01/CLAUDE.md`** - Add development cycle tracking and documentation location sections ✅ **COMPLETE**
- **`/mnt/c/dev/TTCombat/OF2Prototype01/plans/DevCycle_workflow_plan.md`** - Add workflow enhancements for cycle closure and system completion procedures ✅ **COMPLETE**
- **`/mnt/c/dev/TTCombat/OF2Prototype01/src/main/java/combat/AutoTargetingSystem.java`** - Add target incapacitation detection and delay logic
- **`/mnt/c/dev/TTCombat/OF2Prototype01/src/main/java/combat/CombatCoordinator.java`** - Integration with target switching delay logic

**New Components Required:**
- **Development Cycle Tracking Section**: Track completed and current cycles with status ✅ **COMPLETE**
- **Planning Document Structure Section**: Map all plan document locations and purposes ✅ **COMPLETE**
- **Document Location Reference Subsection**: Comprehensive directory structure documentation ✅ **COMPLETE**
- **Cycle Closure Enhancement**: CLAUDE.md update steps integrated into cycle closure workflow ✅ **COMPLETE**
- **Document Archiving Process**: Plan document movement procedures for completed cycles ✅ **COMPLETE**
- **System Completion Protocol**: Standardized steps for system completion within cycles ✅ **COMPLETE**
- **Target Incapacitation Detection**: Monitor when current target becomes incapacitated in auto-targeting mode
- **Target Switch Delay Manager**: Calculate and manage reflexes-modified delay for target switching
- **Auto-Targeting State Management**: Track delay state and prevent premature target switching

### Data Flow
**Information flow for System 1:** ✅ **COMPLETE**
1. **File System Analysis** → **Document Structure Mapping** → **CLAUDE.md Updates**
2. **Plan Directory Scan** → **Template Identification** → **Location Documentation**
3. **Cycle History Review** → **Status Tracking** → **Current Cycle Integration**
4. **Workflow Analysis** → **Process Enhancement Design** → **DevCycle_workflow_plan.md Updates**
5. **System Completion Requirements** → **Protocol Definition** → **Workflow Integration**

**Information flow for System 2:**
1. **Combat Event** → **Target Incapacitation Detection** → **Auto-Targeting State Check**
2. **Incapacitation Trigger** → **Reflexes Stat Lookup** → **Delay Calculation**
3. **Target Switch Delay** → **ScheduledEvent Creation** → **Delay Timer Start**
4. **Delay Completion** → **Auto-Targeting Reactivation** → **Next Target Acquisition**

### Performance Considerations
**System 1:** ✅ **COMPLETE**
- **Memory Impact**: None - documentation-only changes
- **CPU Usage**: None - no computational changes
- **Rendering Impact**: None - no UI/graphics changes
- **Save File Size**: None - no data persistence changes

**System 2:**
- **Memory Impact**: Minimal - small state tracking for target switch delays
- **CPU Usage**: Low - simple reflexes calculation and timer management per target switch
- **Rendering Impact**: None - no visual changes to combat display
- **Event Queue Impact**: Minimal - one additional ScheduledEvent per target switch after incapacitation

## Testing & Validation

### Unit Testing
- [x] **System 1 Core Logic** ✅ **COMPLETE**
  - [x] Verify CLAUDE.md contains accurate cycle tracking information
  - [x] Validate all documented file paths exist and are correct
  - [x] Confirm template documentation matches actual template files
  - [x] Test DevCycle_workflow_plan.md enhancements for completeness and accuracy

- [ ] **System 2 Core Logic**
  - [ ] Test target incapacitation detection (health <= 0) triggers delay for auto-targeting only
  - [ ] Verify reflexes modifier calculation using `15 × (1.0 - (reflexesModifier * 0.015))` formula
  - [ ] Test delay timer creation and completion using ScheduledEvent system
  - [ ] Validate that manual target switching immediately cancels active delays
  - [ ] Test that movement orders cancel active delays
  - [ ] Verify damage taken does NOT cancel delays
  - [ ] Test "first incapacitation only" logic prevents delay stacking from burst fire
  - [ ] Validate that range/obstruction/zone target changes do NOT trigger delays

### System Integration Testing
- [x] **System 1 Integration** ✅ **COMPLETE**
  - [x] Verify CLAUDE.md updates don't break existing documentation structure
  - [x] Confirm new sections integrate properly with existing content
  - [x] Test that documented paths remain valid after updates
  - [x] Validate workflow enhancements integrate properly with existing cycle processes

- [ ] **System 2 Integration**
  - [ ] Test integration with existing AutoTargetingSystem without disrupting manual targeting or other target changes
  - [ ] Verify compatibility with CombatCoordinator target management and zone priority system
  - [ ] Test integration with existing reflexes stat system using GameConstants.statToModifier()
  - [ ] Validate ScheduledEvent system handles target switch delays correctly
  - [ ] Test that delays remain separate from weapon states (overlap with aiming/reloading/recovering)
  - [ ] Verify no interference with Quickdraw skill calculations
  - [ ] Test same delay behavior across all weapon types (pistol/rifle/submachine gun)

### User Experience Testing
- [x] **System 1 User Experience** ✅ **COMPLETE**
  - [x] Verify CLAUDE.md is easy to navigate with new sections
  - [x] Confirm cycle tracking information is clear and accessible
  - [x] Test that plan document locations are easily findable
  - [x] Ensure workflow procedures are clear and actionable for future cycle management

- [ ] **System 2 User Experience**
  - [ ] Test that target switching feels more realistic and less robotic in auto-targeting mode (no instant switching)
  - [ ] Verify delay timing feels appropriate for different reflexes values (high reflexes = noticeably faster)
  - [ ] Confirm manual target switching remains immediate and responsive (cancels any active delay)
  - [ ] Validate that movement orders properly cancel delays and feel responsive
  - [ ] Test that 15-tick base delay (0.25 seconds) provides good balance of realism vs. gameplay flow
  - [ ] Verify no additional visual/audio feedback needed - delay timing provides sufficient user feedback

### Technical Validation
- [x] **System 1 Compilation and Build** ✅ **COMPLETE**
  - [x] `mvn compile` passes without errors (no code changes)
  - [x] `mvn test` passes all existing tests (no functional changes)
  - [x] CLAUDE.md syntax and formatting validation

- [ ] **System 2 Compilation and Build**
  - [ ] `mvn compile` passes without errors after AutoTargetingSystem modifications
  - [ ] `mvn test` passes all existing tests without regressions
  - [ ] New target switch delay functionality works in live testing with reflexes-modified timing
  - [ ] Analysis/output.txt scenario shows appropriate delay between target switches after incapacitation
  - [ ] Validate delay calculations: reflexes 50 = 15 ticks, reflexes 90 = ~13 ticks, reflexes 10 = ~18 ticks
  - [ ] Test multiple incapacitation scenarios show single delay (no stacking from burst fire)

## Implementation Timeline

### Phase 1: System 1 Implementation (Estimated: 1.5 hours) ✅ **COMPLETE**
- [x] Analyze current CLAUDE.md structure and plan directory organization
- [x] Implement development cycle tracking section with DevCycle 36 completion status
- [x] Add comprehensive plan document location mapping and template documentation
- [x] Enhance DevCycle_workflow_plan.md with cycle closure and system completion procedures

### Phase 2: System 1 Testing and Validation (Estimated: 45 minutes) ✅ **COMPLETE**
- [x] Validate all documented paths and file references are accurate
- [x] Test CLAUDE.md formatting and readability
- [x] Confirm integration with existing documentation structure
- [x] Review workflow enhancements for completeness and practical applicability

### Phase 3: System 2 Implementation (Estimated: 2 hours)
- [ ] Analyze current AutoTargetingSystem and target switching logic
- [ ] Implement incapacitation-specific detection (health <= 0) in auto-targeting mode only
- [ ] Add reflexes-modified delay calculation using existing formula: `15 × (1.0 - (reflexesModifier * 0.015))`
- [ ] Integrate delay timing with ScheduledEvent system
- [ ] Implement delay state management (isWaitingForTargetSwitch flag)
- [ ] Add manual target assignment and movement order cancellation logic
- [ ] Implement "first incapacitation only" logic to prevent delay stacking

### Phase 4: System 2 Testing and Validation (Estimated: 1 hour)
- [ ] Unit test target switch delay calculation with different reflexes values
- [ ] Test incapacitation detection vs. other target change types (range/obstruction/zones)
- [ ] Integration test delay cancellation (manual targeting, movement orders)
- [ ] Live test using analysis/output.txt scenario to verify realistic delay behavior
- [ ] Validate burst fire scenarios show single delay (no stacking)
- [ ] Test that manual targeting and other auto-targeting behaviors remain unaffected

### Phase 5: System 3+ Planning (Estimated: TBD)
- [ ] Assess results from System 1 and System 2
- [ ] Identify next highest priority issue for potential System 3
- [ ] Plan additional system implementation if needed

## Quality Assurance

### Code Quality
- [ ] **Code Review Checklist**
  - [ ] System 1 follows existing code patterns and conventions
  - [ ] Proper error handling for edge cases
  - [ ] Clear debug output for troubleshooting
  - [ ] Minimal impact on existing functionality

### Documentation Requirements
- [ ] **Code Documentation**
  - [ ] Document System 1 logic and integration points
  - [ ] Update method comments as needed
  - [ ] Add inline comments for complex logic

## Risk Assessment

### Technical Risks
- **System 1 Complexity**: Low - Documentation update with minimal complexity
- **Integration Risk**: Low - No code integration, only documentation enhancement
- **Performance Risk**: None - No performance impact from documentation changes

### Quality Risks
- **Regression Risk**: None - No functional code changes that could cause regressions
- **Documentation Accuracy**: Medium - Risk of documenting incorrect file paths or outdated information

## Success Criteria

### Functional Requirements
- [ ] System 1 implemented and functional as specified
- [ ] No regression in existing functionality
- [ ] Integration testing passes without critical issues
- [ ] Performance impact is within acceptable limits

### Quality Requirements
- [ ] Code compiles without errors or warnings
- [ ] All existing tests continue to pass
- [ ] System 1 provides clear indication of operation (debug output, user feedback, etc.)

## Post-Implementation Review

### Implementation Summary
*[To be completed after each system implementation]*

**Actual Implementation Time**: 1.5 hours (System 1 completed July 2, 2025)

**Systems Completed**:
- **✅ System 1**: CLAUDE.md Development Cycle Tracking Enhancement - Added comprehensive cycle tracking and document location mapping to CLAUDE.md, enhanced DevCycle_workflow_plan.md with cycle closure and system completion procedures
- **⭕ System 2**: Target Switch Delay After Incapacitation - **PLANNED** - Implement reflexes-modified delay when auto-targeting switches targets after incapacitation
- **⭕ System 3+**: Awaiting identification after System 2 completion

### Key Achievements
*[To be completed after each system implementation]*

**System 1 Achievements:**
- **Comprehensive Cycle Tracking**: CLAUDE.md now tracks last completed cycle (DevCycle 36) and current active cycle (DevCycle 37)
- **Complete Document Location Mapping**: All plan documents, templates, and completed cycles are documented with full paths
- **Enhanced Workflow Procedures**: DevCycle_workflow_plan.md includes CLAUDE.md maintenance, document archiving, and system completion protocols
- **Security Enhancement**: Added user authorization requirements for development cycle closure procedures
- **Future-Proof Documentation**: Established maintenance guidelines for keeping cycle tracking current

### Files Modified
*[To be completed during implementation of each system]*

**System 1 Files Modified:**
- `/mnt/c/dev/TTCombat/OF2Prototype01/CLAUDE.md` - Added "Development Cycle Tracking" and "Planning Document Structure" sections, enhanced git rules with user authorization requirements for cycle closure
- `/mnt/c/dev/TTCombat/OF2Prototype01/plans/DevCycle_workflow_plan.md` - Added "CLAUDE.md Maintenance Procedures" section with cycle closure, system completion protocols, and user authorization security procedures

### Lessons Learned
*[To be completed after each system implementation]*

**System 1 Lessons:**
- **Documentation Maintenance Importance**: Manual cycle tracking requires systematic workflow integration to prevent information drift
- **Path Validation Critical**: All documented file paths must be verified during implementation to ensure accuracy
- **Workflow Enhancement Value**: Adding procedures to existing workflow documents prevents future oversight

### Future Enhancements
*[To be identified during implementation of each system]*

**System 1 Future Enhancements:**
- **Automated Cycle Tracking**: Consider scripting automatic CLAUDE.md updates during cycle closure
- **Document Link Validation**: Implement automated checking of documented file paths
- **Template Evolution**: Keep templates current with workflow enhancements discovered during implementation

---

## Development Cycle Workflow Reference

### Git Branch Management
```bash
# Create development branch
git checkout main
git pull origin main
git checkout -b DC_37

# Development workflow
git add [files]
git commit -m "DC-37: [Description]"

# Completion workflow (ONLY when cycle closure is explicitly ordered)
# ⚠️ DO NOT RUN UNTIL EXPLICITLY TOLD TO CLOSE THE CYCLE ⚠️
git checkout main
git merge DC_37
git branch -d DC_37
```

### Commit Message Format
- **Format**: `DC-37: [Brief description]`
- **Examples**: 
  - `DC-37: [Example will be added when System 1 is identified]`
  - `DC-37: [Example will be added when System 1 is identified]`
  - `DC-37: [Example will be added when System 1 is identified]`

### Testing Commands
```bash
mvn compile                    # Verify compilation
mvn test                      # Run existing tests  
mvn test -Dtest=[TestName]     # Run specific test
```

---

## 🔄 CYCLE COMPLETION POLICY

### Critical Rule: Cycles Are Never "Complete" Until Explicitly Closed

**Individual Systems vs. Entire Cycle:**
- ✅ **Systems can be marked complete** when all their tasks are finished and tested
- ❌ **Cycles are NEVER complete** until explicitly ordered to close out
- 🔄 **Cycles remain open** even when all currently planned systems are finished

### Why Cycles Stay Open:
1. **Iterative Discovery**: Implementation often reveals new issues or opportunities
2. **Continuous Improvement**: Additional systems may be identified during development
3. **Flexible Scope**: Cycles adapt to emerging needs and findings
4. **User Control**: Only the user decides when a cycle has accomplished enough

### Cycle Status Language:
- ✅ **"System N Complete"** - Individual system is finished
- ⭕ **"All Current Systems Complete"** - All planned systems finished, but cycle open
- 🚫 **NEVER say "Cycle Complete"** unless explicitly ordered to close out
- 🔄 **"Cycle Ready for Additional Systems"** - Appropriate status when systems done

### Git Branch Management Implications:
- **DO NOT merge development branch** until cycle closure is ordered
- **Commit individual system completions** but keep branch separate
- **Branch remains active** for potential additional systems
- **Merge only occurs** during explicit cycle closure process

### Documentation Status Implications:
- Mark individual systems as ✅ **COMPLETE** when finished
- Update cycle status to reflect current system completion
- Never mark overall cycle as complete in documentation
- Always leave room for additional systems to be added

---

## ⚠️ ITERATIVE DEVELOPMENT REMINDERS ⚠️

### For Template Users:
1. **NEVER plan System 2+ while working on System 1**
2. **NEVER implement before planning is complete**
3. **NEVER add hints about future systems to placeholder sections**
4. **NEVER consider cycle complete until explicitly ordered to close**
5. **ALWAYS complete current system fully before considering next**
6. **ALWAYS test thoroughly before moving to next system**
7. **ALWAYS keep cycles open for potential additional systems**

### For System Planning:
- Plan only the current system in detail
- Leave future system sections as empty placeholders
- Add systems iteratively as they are identified
- Focus on one problem at a time

### For Implementation:
- Implement only planned systems
- Complete all testing before next system
- Update documentation as you go
- Mark tasks as complete immediately after finishing

---

*This iterative development cycle focuses on implementing one system at a time while maintaining flexibility for additional improvements discovered during implementation. Each system is completed fully before considering the next, ensuring focused development and thorough validation. The cycle remains open for additional systems until explicitly ordered to close, even when all currently planned systems are complete.*

---

## Planning Questions for User Review

Based on my comprehensive review of System 2 planning, I have identified several areas requiring clarification before implementation can proceed:

### Technical Implementation Questions

1. **Target Switch Delay Scope**: Should the 15-tick delay apply to ALL automatic target switches (including when targets move out of range, become obstructed, etc.) or only when the current target becomes incapacitated?
   
   **Recommendation**: Apply delay ONLY when the current target becomes incapacitated. Other target switches (range, obstruction, zone changes) should remain immediate for responsive gameplay. Incapacitation specifically represents the cognitive processing time needed to recognize "target down, need new target."
- Please follow the recommendation

2. **Delay Formula Clarification**: The current design specifies `targetSwitchDelay = 15 ticks × reflexesSpeedMultiplier`. However, the existing reflexes system uses `1.0 - (reflexesModifier * 0.015)` where lower values mean faster. For target switch delays, should:
   - Lower reflexes = longer delay (more confusion when target goes down)?
   - Higher reflexes = shorter delay (faster target reacquisition)?
   - What specific scaling factor should be used (0.015 like weapon readying, or different)?

   **Recommendation**: Use the same formula pattern as weapon readying for consistency: `targetSwitchDelay = 15 × (1.0 - (reflexesModifier * 0.015))`. Higher reflexes = shorter delay (faster target reacquisition). This maintains system consistency and intuitive stat behavior where higher reflexes always means faster reactions.
- Please follow the recommendation

3. **Delay State Management**: During the target switch delay period, what should happen if:
   - The character is manually given a new target?
   - The character is ordered to move or perform another action?
   - A new enemy appears closer than the queued next target?
   - The character takes damage or is attacked during the delay?

   **Recommendation**: Manual actions should immediately cancel the delay (player control overrides auto-targeting). Movement orders should cancel the delay. New closer enemies should NOT interrupt the delay (prevents overly complex priority recalculation). Taking damage should NOT cancel the delay (maintains realism of processing time).
- Please follow the recommendation

4. **Integration with Existing Combat States**: Should target switch delays be:
   - Separate from weapon state timing (can overlap with aiming/reloading)?
   - Integrated with existing combat state machine?
   - Cancelled by certain weapon states (like reloading or recovering)?

   **Recommendation**: Keep target switch delays separate from weapon states - they represent mental processing, not physical weapon manipulation. Allow overlap with aiming/reloading. Do NOT cancel delays for weapon states - the character can reload while mentally processing target selection.
- Please follow the recommendation

5. **Multiple Target Incapacitation**: If the character incapacitates multiple targets in rapid succession (burst fire, multiple projectiles), should:
   - Each incapacitation trigger a separate delay?
   - Only the first incapacitation trigger the delay?
   - The delay reset with each new incapacitation?

   **Recommendation**: Only the first incapacitation triggers the delay. Subsequent incapacitations during the delay period should not reset or extend it. This prevents excessive delays from burst fire while maintaining the core realism benefit.
- Please follow the recommendation

### User Experience Questions

6. **Delay Timing Feedback**: Should there be any visual or audio feedback during the target switch delay to indicate the character is "processing" the target change?

   **Recommendation**: No additional feedback for initial implementation. The delay itself is the feedback - players will notice the more realistic timing. Adding visual/audio cues could be considered in future enhancements but would complicate the initial implementation unnecessarily.
- Please follow the recommendation

7. **Delay Duration Balancing**: Is 15 ticks (0.25 seconds) the correct base duration, or should this be:
   - Longer for more noticeable realism (30-45 ticks)?
   - Shorter for better gameplay flow (5-10 ticks)?
   - Configurable through game settings?

   **Recommendation**: Start with 15 ticks (0.25 seconds) as specified in the original request. This is noticeable enough to address the unrealistic instant switching but short enough to maintain gameplay flow. Avoid configurability in initial implementation - keep it simple and adjust based on testing feedback.
- Please follow the recommendation

### System Integration Questions

8. **Quickdraw Skill Integration**: Should the Quickdraw skill (currently used for weapon readying speed) also affect target switch delays, or should delays only use reflexes modifiers?

   **Recommendation**: Use only reflexes modifiers for target switch delays. Quickdraw represents physical weapon manipulation speed, while target switching represents mental/perceptual processing. Keep the systems conceptually separate to maintain clear stat purposes and avoid overly complex calculations.
- Please follow the recommendation

9. **Weapon-Specific Delays**: Should different weapon types have different base target switch delays:
   - Submachine guns: faster target switching due to closer combat?
   - Rifles: slower target switching due to precision requirements?
   - Or should all weapons use the same base 15-tick delay?

   **Recommendation**: Use the same base 15-tick delay for all weapons. Target switching delay represents mental processing time, not weapon-specific factors. This keeps the implementation simple and focuses on the core reflexes-based modification. Weapon-specific variations could be considered in future enhancements.
- Please follow the recommendation

10. **Auto-Targeting Zone Priority**: When the delay expires and the system needs to find a new target, should it:
    - Use the same zone priority system as currently implemented?
    - Prefer targets that were "next closest" when the delay started?
    - Re-evaluate all targets fresh when the delay completes?

    **Recommendation**: Use the existing zone priority system for consistency with current auto-targeting behavior. Re-evaluate all targets fresh when the delay completes - this ensures the character gets the best target available at that moment, not outdated target selection from when the delay started.
- Please follow the recommendation

### Implementation Priority Questions

11. **Minimum Viable Implementation**: For initial implementation, should we:
    - Start with a simple fixed delay (no reflexes modifier) to prove the concept?
    - Implement the full reflexes-modified system immediately?
    - Add configurability for testing different delay values?

    **Recommendation**: Implement the full reflexes-modified system immediately. The reflexes calculation is well-established and straightforward to implement. Starting with a fixed delay would require implementing the same integration points and then modifying them, creating unnecessary rework.
- Please follow the recommendation

12. **Testing Validation**: What specific scenarios should be tested to validate the implementation:
    - The exact analysis/output.txt scenario with Alice vs. Drake/Bobby/Frank?
    - Multi-target burst fire scenarios?
    - Mixed manual and auto-targeting scenarios?
    - Different reflexes values for timing validation?

    **Recommendation**: Test all listed scenarios in priority order: (1) The exact analysis/output.txt scenario to verify the core problem is solved, (2) Different reflexes values to validate modifier calculations, (3) Manual targeting override to ensure player control works, (4) Burst fire scenarios to verify single-delay behavior. This provides comprehensive validation while focusing on the primary use case first.
- Please follow the recommendation
